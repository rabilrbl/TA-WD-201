<div class="w-full space-y-4">
  <h1 class="text-4xl font-extrabold">My Todo-list</h1>
  <div class="pt-2">
    <form class="flex flex-col md:flex-row gap-2" action="/todos" method="POST">
      <!-- CSRF -->
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <input
        type="text"
        name="title"
        class="border-2 border-gray-300 bg-transparent p-2 rounded-lg flex-auto"
        placeholder="Add a new todo"
        required
      />
      <input
        type="date"
        name="dueDate"
        class="border-2 border-gray-300 bg-transparent p-2 rounded-lg flex-auto"
        required
      />
      <button
        type="submit"
        class="bg-green-500 text-white p-2 px-4 rounded-lg flex-none"
      >
        Add
      </button>
    </form>
  </div>
  <div class="space-y-4">
    <% if (overdueTodos.length > 0) { %>
    <!-- Overdue -->
    <div>
      <%- include('todoview', { todos: overdueTodos, todoTitle: 'Overdue',
      countid: 'count-overdue' }) %>
    </div>
    <% } %> <% if (dueTodayTodos.length > 0) {%>
    <!-- Due Today -->
    <div>
      <%- include('todoview', { todos: dueTodayTodos, todoTitle: 'Due Today',
      countid: 'count-due-today' }) %>
    </div>
    <% } %> <% if (dueLaterTodos.length > 0) {%>
    <!-- Due Later -->
    <div>
      <%- include('todoview', { todos: dueLaterTodos, todoTitle: 'Due Later',
      countid: 'count-due-later' }) %>
    </div>
    <% } %> <% if (completedTodos.length > 0) {%>
    <!-- Completed -->
    <div>
      <%- include('todoview', { todos: completedTodos, todoTitle: 'Completed',
      countid: 'count-completed' }) %>
    </div>
    <% } %>
  </div>
</div>
<script>
  const _csrf = document.querySelector('meta[name="csrf-token"]').content;
  const updateTodo = async (id) => {
    const todo = document.getElementById(`todo-${id}`);
    const completed = todo.checked;
    await fetch(`/todos/${id}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ completed, _csrf: _csrf }),
    })
      .then((res) => {
        if (res.ok) {
          window.location.reload();
        }
      })
      .catch((err) => {
        console.log(err);
      });
  };
  const deleteTodo = async (id) => {
    await fetch(`/todos/${id}`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ _csrf: _csrf }),
    })
      .then((res) => {
        if (res.ok) {
          window.location.reload();
        }
      })
      .catch((err) => {
        console.log(err);
      });
  };
</script>
